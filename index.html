<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Redirecionando...</title>
  <script>
    (function() {
      const params = new URLSearchParams(window.location.search);
      const idMensagem = params.get("id");
      const tipo = params.get("type");
      const numero = params.get("numero");
      const nome = params.get("nome");

      if (idMensagem) {
        const webAppUrl = "https://script.google.com/macros/s/AKfycbwkc7674s3_YfXsiv1vQzzOx0QzVjWptbJi10wA4N1_mN5Xu1Rsu5-vP4m5py443iXI/exec";
        const urlRegistro = `${webAppUrl}?funcao=registrarCompra&id=${encodeURIComponent(idMensagem)}`;
        
        // Usando sendBeacon para garantir que a requisição seja enviada mesmo no redirecionamento
        navigator.sendBeacon(urlRegistro);
      }

      let destino = "https://t.me/dividir_contas_premium";
      if (tipo === "whatsapp" && numero) {
        destino = `https://wa.me/${numero}`;
      } else if (tipo === "telegram" && nome) {
        destino = `https://t.me/${nome.replace(/^@/, "")}`;
      }

      // Redireciona após um pequeno atraso para garantir envio
      setTimeout(() => {
        window.location.href = destino;
      }, 50);
    })();
  </script>
</head>
<body>
  <p>Redirecionando...</p>
</body>
</html>
